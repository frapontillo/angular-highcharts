/**
 * angular-highcharts-chart-directive
 * @version v0.1.0 - 2013-09-23
 * @author Francesco Pontillo <francescopontillo@gmail.com>
 * @link https://github.com/frapontillo/angular-highcharts
 * @license Apache License 2.0
 */

angular.module("frapontillo.highcharts",["frapontillo.highcharts.directives"]),angular.module("frapontillo.highcharts.directives",[]).directive("chart",["$filter",function(a){return{restrict:"E",template:"<div></div>",transclude:!0,replace:!0,scope:{value:"=",hiddenSeries:"=",type:"="},link:function(b,c,d){b.chart=null;var e=function(a){var c=a.currentTarget.series,d=[];for(var e in c)c[e].visible||d.push(e);angular.equals(b.hiddenSeries,d)||(angular.copy(d,b.hiddenSeries),b.$apply())},f=function(){if(b.chart&&b.hiddenSeries){for(var c in b.chart.series){var d=!a("filter")(b.hiddenSeries,c).length;b.chart.series[c].setVisible(d,!1)}b.chart.redraw()}},g=function(a){if(a&&a.exporting)for(var b in a.exporting.buttons)h(a.exporting.buttons[b])},h=function(a){a.onclick&&(a.onclick=function(){var c=a.onclick;return function(){var a=c.apply(this,arguments);return b.$apply(),a}}()),a.menuItems&&a.menuItems.length>0&&angular.forEach(a.menuItems,function(a){h(a)})},i=function(){if(b.value){var a={chart:{renderTo:c[0],events:{redraw:e},type:b.type||null,height:d.height||null,width:d.width||null}},h={};jQuery.extend(!0,h,a),jQuery.extend(!0,h,b.value),g(h),b.chart&&b.chart.destroy(),b.chart=new Highcharts.Chart(h),f()}};b.$watch("value",i),b.$watch("type",i),b.$watch("hiddenSeries",function(){b.chart&&f()})}}}]);